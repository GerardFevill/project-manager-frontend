<h2 mat-dialog-title>{{ data ? 'Modifier la tâche' : 'Créer une nouvelle tâche' }}</h2>
<mat-dialog-content>
  <div class="form-content">
    <!-- Title -->
    <mat-form-field appearance="outline">
      <mat-label>Titre de la tâche</mat-label>
      <input matInput [(ngModel)]="taskData.title" required />
    </mat-form-field>

    <!-- Description -->
    <mat-form-field appearance="outline">
      <mat-label>Description (optionnel)</mat-label>
      <textarea matInput [(ngModel)]="taskData.description" rows="4"></textarea>
    </mat-form-field>

    <!-- Status & Priority -->
    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Statut</mat-label>
        <mat-select [(ngModel)]="taskData.status">
          <mat-option [value]="TaskStatus.DRAFT">Brouillon</mat-option>
          <mat-option [value]="TaskStatus.ACTIVE">Active</mat-option>
          <mat-option [value]="TaskStatus.COMPLETED">Terminée</mat-option>
          <mat-option [value]="TaskStatus.BLOCKED">Bloquée</mat-option>
          <mat-option [value]="TaskStatus.RECURRING">Récurrente</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Priorité</mat-label>
        <mat-select [(ngModel)]="taskData.priority">
          <mat-option value="low">Faible</mat-option>
          <mat-option value="medium">Moyenne</mat-option>
          <mat-option value="high">Haute</mat-option>
          <mat-option value="urgent">Urgente</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Progress Slider -->
    <div class="progress-section">
      <label class="field-label">Progression: {{ taskData.progress }}%</label>
      <mat-slider
        min="0"
        max="100"
        step="5"
        discrete
        [displayWith]="formatLabel"
      >
        <input matSliderThumb [(ngModel)]="taskData.progress">
      </mat-slider>
    </div>

    <!-- Dates -->
    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Date de début</mat-label>
        <input matInput [matDatepicker]="startPicker" [(ngModel)]="taskData.startDate" />
        <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Date d'échéance</mat-label>
        <input matInput [matDatepicker]="duePicker" [(ngModel)]="taskData.dueDate" />
        <mat-datepicker-toggle matIconSuffix [for]="duePicker"></mat-datepicker-toggle>
        <mat-datepicker #duePicker></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- Recurrence -->
    <app-task-recurrence-selector
      [(ngModel)]="taskData.recurrence"
    ></app-task-recurrence-selector>

    @if (taskData.recurrence && taskData.recurrence !== TaskRecurrence.NONE) {
      <mat-form-field appearance="outline">
        <mat-label>Prochaine occurrence</mat-label>
        <input matInput type="datetime-local" [(ngModel)]="taskData.nextOccurrence" />
      </mat-form-field>
    }

    <!-- Time tracking -->
    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Heures estimées</mat-label>
        <input matInput type="number" [(ngModel)]="taskData.estimatedHours" min="0" step="0.5" />
        <mat-hint>Temps estimé en heures</mat-hint>
      </mat-form-field>

      @if (data) {
        <mat-form-field appearance="outline">
          <mat-label>Heures réelles</mat-label>
          <input matInput type="number" [(ngModel)]="taskData.actualHours" min="0" step="0.5" />
          <mat-hint>Temps réellement passé</mat-hint>
        </mat-form-field>
      }
    </div>

    <!-- Tags -->
    <app-task-tags-input
      [(ngModel)]="taskData.tags"
    ></app-task-tags-input>
  </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button [mat-dialog-close]="null">Annuler</button>
  <button mat-raised-button color="primary" (click)="onSubmit()">
    {{ data ? 'Modifier' : 'Créer' }}
  </button>
</mat-dialog-actions>
