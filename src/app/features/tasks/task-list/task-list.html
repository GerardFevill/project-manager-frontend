<div class="task-list-container">
  <div class="header">
    <h1>Project Manager</h1>
    <button class="btn-primary" (click)="openCreateTaskDialog()">
      New Task
    </button>
  </div>

  <!-- Filters -->
  <div class="filters">
    <select [(ngModel)]="filters.status" (change)="loadTasks()" class="input-field">
      <option value="all">All Tasks</option>
      <option value="active">Active</option>
      <option value="completed">Completed</option>
    </select>
    <select [(ngModel)]="filters.priority" (change)="loadTasks()" class="input-field">
      <option [value]="undefined">All Priorities</option>
      <option value="low">Low</option>
      <option value="medium">Medium</option>
      <option value="high">High</option>
      <option value="urgent">Urgent</option>
    </select>
    <label class="checkbox-label">
      <input type="checkbox" [(ngModel)]="filters.onlyRoot" (change)="loadTasks()" />
      Root tasks only
    </label>
  </div>

  <!-- Task Table -->
  <div class="table-container">
    @if (loading()) {
      <div class="loading">Loading tasks...</div>
    } @else if (tasks().length === 0) {
      <div class="empty">No tasks found. Create your first task!</div>
    } @else {
      <table mat-table [dataSource]="tasks()" class="tasks-table">

        <!-- Title Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Titre</th>
          <td mat-cell *matCellDef="let task">
            <div class="title-cell" [class.completed-text]="task.completed">
              {{ task.title }}
            </div>
          </td>
        </ng-container>

        <!-- Description Column -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Description</th>
          <td mat-cell *matCellDef="let task">
            <div class="description-cell">
              {{ task.description || '-' }}
            </div>
          </td>
        </ng-container>

        <!-- Priority Column -->
        <ng-container matColumnDef="priority">
          <th mat-header-cell *matHeaderCellDef>Priorité</th>
          <td mat-cell *matCellDef="let task">
            <span class="priority priority-{{ task.priority }}">
              {{ task.priority }}
            </span>
          </td>
        </ng-container>

        <!-- Due Date Column -->
        <ng-container matColumnDef="dueDate">
          <th mat-header-cell *matHeaderCellDef>Échéance</th>
          <td mat-cell *matCellDef="let task">
            {{ task.dueDate ? (task.dueDate | date:'short') : '-' }}
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Statut</th>
          <td mat-cell *matCellDef="let task">
            <input
              type="checkbox"
              [checked]="task.completed"
              (change)="toggleTask(task.id)"
              class="task-checkbox"
              [matTooltip]="task.completed ? 'Marquer comme active' : 'Marquer comme complétée'"
            />
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let task">
            <div class="action-buttons">
              <button
                mat-icon-button
                (click)="viewTask(task)"
                matTooltip="Voir"
                class="action-btn view-btn"
              >
                <mat-icon>visibility</mat-icon>
              </button>
              <button
                mat-icon-button
                (click)="editTask(task)"
                matTooltip="Éditer"
                class="action-btn edit-btn"
              >
                <mat-icon>edit</mat-icon>
              </button>
              <button
                mat-icon-button
                (click)="duplicateTask(task)"
                matTooltip="Dupliquer"
                class="action-btn duplicate-btn"
              >
                <mat-icon>content_copy</mat-icon>
              </button>
              <button
                mat-icon-button
                (click)="deleteTask(task.id)"
                matTooltip="Supprimer"
                class="action-btn delete-btn"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" [class.completed-row]="row.completed"></tr>
      </table>
    }
  </div>
</div>
